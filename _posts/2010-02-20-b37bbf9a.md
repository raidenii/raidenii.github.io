---
layout: single
title: 折腾WRT54GS手记之二
date: 2010-02-20 23:36:06.000000000 -05:00
tags: []
permalink: "/2010/02/63"
---
上回说到入手WRT54GS后刷固件，这回主要是OpenWRT和救半砖的故事。

DD-WRT刷上去之后感觉不爽，因为mega的很多功能我不用，而且还占地方，mega版本有足足5M大。于是想到刷另外一个第三方固件：OpenWRT。刷上去很简单，从DD的网页管理上很容易就刷了。但是刷上去才发现，OpenWRT没有web管理，真正的一个白板，要做修改必须用Telnet/SSH登上去一条一条地改，这也太痛苦了。

白板用起来也太困难了，看有没有什么好的替代品，于是找到了OpenWRT的衍生版 - X-Wrt。简而言之，X-Wrt基本上就是在OpenWRT上加了个Web UI，当然还有些其他的东西，不过我暂时没用到。

X-Wrt总体上来说感觉不错，但是中间有一次手贱调整无线网络设置的时候没等加载完毕就把网页关了，结果路由从此就ping不通了。 往常的tftp看ping来刷机的方式行不通了。看网上说法，基本都说要么用JTAG线直刷要么短接flash引脚来使路由进failsafe mode再用tftp刷。JTAG引脚还没焊上去，第一条否绝。短接引脚，手里没这么细的螺丝刀，况且怕手一抖把板子烧掉，加上本人做这种事的时候一向手都会抖。

有人说设置tftp重试255次，先点upgrade，在tftp重试的时候插电就可以刷。但是手里的这个tftp只要没连上就一直显示Erasing flash，根本没不断重试的意思啊喂！

不死心继续找，发现有人说在插电源后lan灯全熄灭的一瞬间可以用tftp刷，虽然后面跟帖的大多说此法无效，不过算了，死马当活马医吧。试了下，第一次太紧张灯熄灭之前就刷，结果连不上去。第二次找准时机，终于看到Upgrading flash 救活了！

活是活了，但是刷进去的是官版fw，然后访问web界面始终转到passwd.sh然后提示404 not found 估计是之前在nvram里面的信息没抹干净，用tftp+ping刷dd-wrt mini（cmd-\>ping 192.168.1.1 -t，拔电源再插上，再次ping通的时候立马按upgrade）然后再刷回X-wrt。

教训：一定等页面加载完成再关，X-wrt的web界面反应感觉比dd-wrt的慢，特别是涉及到向nvram写入设置的，所以一定要有耐心。

现在路由上只放了个锐捷的认证客户端，但是没条件测，要等到暑假research做完回家再说了。JTAG线和底座也收到了，虽然完全是粗制滥造的

有空把JTAG的底座焊上去，这就相当于加了保险，再怎么乱刷都可以救回来了。